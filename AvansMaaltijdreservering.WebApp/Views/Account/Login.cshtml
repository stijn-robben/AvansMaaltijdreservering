@model AvansMaaltijdreservering.WebApp.ViewModels.Account.LoginViewModel
@{
    ViewData["Title"] = "Login";
}

<div class="mt-4">
    <div class="row justify-content-center">
        <div class="col-md-4">
            <!-- Login Form Card -->
            <div class="package-details-card">
                @if (TempData["SuccessMessage"] != null)
                {
                    <div class="alert alert-success alert-dismissible fade show" role="alert" style="margin-bottom: var(--spacing-lg);">
                        <i class="bi bi-check-circle"></i> @TempData["SuccessMessage"]
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                }

                <form asp-action="Login" asp-route-returnUrl="@ViewData["ReturnUrl"]" method="post" id="loginForm">
                    <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert" style="display: none;"></div>

                    <!-- Login Information -->
                    <h3 class="labrada-font" style="color: var(--color-primary-dark); margin-bottom: var(--spacing-lg);">
                        Login to your account
                    </h3>

                    <div style="margin-bottom: var(--spacing-xl);">
                        <input asp-for="Email" class="register-round-input" placeholder="Email address" />
                        <span asp-validation-for="Email" class="text-danger"></span>
                    </div>

                    <div style="margin-bottom: var(--spacing-xl);">
                        <input asp-for="Password" type="password" class="register-round-input" placeholder="Password" />
                        <span asp-validation-for="Password" class="text-danger"></span>
                    </div>

                    <div style="margin-bottom: var(--spacing-xl);">
                        <label class="login-checkbox-container">
                            <input asp-for="RememberMe" type="checkbox" class="login-checkbox" />
                            <span class="login-checkmark"></span>
                            <span class="login-checkbox-text">Remember me on this device</span>
                        </label>
                    </div>

                    <div class="package-details-buttons">
                        <button type="submit" class="btn-package-reserve">
                            Login
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
            
    <!-- Register Link -->
    <div class="text-center" style="margin-top: var(--spacing-lg);">
        <p class="text-muted mb-0">
            Don't have an account? 
            <a asp-action="Register" class="meal-filter-btn" style="display: inline-block; margin-left: var(--spacing-sm);">
                <i class="bi bi-person-plus"></i> Register here
            </a>
        </p>
    </div>
</div>

@{
    var hasErrors = !ViewData.ModelState.IsValid && ViewData.ModelState.ErrorCount > 0;
}

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var hasErrors = @Json.Serialize(hasErrors);
            
            if (hasErrors) {
                // Clear only the password field, keep email
                const passwordInput = document.querySelector('input[name="Password"]');
                
                if (passwordInput) passwordInput.value = '';
                
                // Add red border class to inputs
                const inputs = document.querySelectorAll('#loginForm .register-round-input');
                inputs.forEach(input => {
                    input.classList.add('login-error-border');
                });
                
                // Remove red border after 1 second
                setTimeout(function() {
                    inputs.forEach(input => {
                        input.classList.remove('login-error-border');
                    });
                }, 1000);
            }
        });
    </script>
}