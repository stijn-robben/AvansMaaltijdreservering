@model AvansMaaltijdreservering.WebApp.Controllers.StudentDashboardViewModel

@{
    ViewData["Title"] = "Dashboard";
}

<div class="container py-4 fade-in-up">
    <!-- Welcome Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card dashboard-card">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h2 class="mb-1">
                                <i class="bi bi-speedometer2 text-primary me-2"></i>
                                Welcome back, @Model.Student.Name!
                            </h2>
                            <p class="text-muted mb-0">
                                <i class="bi bi-geo-alt me-1"></i>@Model.Student.StudyCity Campus
                                @if (Model.Student.IsBlocked())
                                {
                                    <span class="badge bg-danger ms-3">
                                        <i class="bi bi-exclamation-triangle me-1"></i>Account Blocked
                                    </span>
                                }
                            </p>
                        </div>
                        <div class="col-md-4 text-md-end">
                            <div class="btn-group" role="group">
                                <a href="@Url.Action("AvailablePackages")" class="btn btn-primary">
                                    <i class="bi bi-search me-1"></i>Browse Packages
                                </a>
                                <a href="@Url.Action("Profile")" class="btn btn-outline-primary">
                                    <i class="bi bi-person-gear me-1"></i>Profile
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="row mb-4">
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card text-center h-100">
                <div class="card-body stats-card">
                    <i class="bi bi-bookmark-heart text-primary" style="font-size: 2rem;"></i>
                    <div class="stats-number text-primary">@Model.MyReservations.Count()</div>
                    <div class="stats-label">Active Reservations</div>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card text-center h-100">
                <div class="card-body stats-card">
                    <i class="bi bi-currency-euro text-success" style="font-size: 2rem;"></i>
                    <div class="stats-number text-success">€@Model.MyReservations.Sum(r => r.Price).ToString("F0")</div>
                    <div class="stats-label">Total Value</div>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card text-center h-100">
                <div class="card-body stats-card">
                    <i class="bi bi-exclamation-triangle text-warning" style="font-size: 2rem;"></i>
                    <div class="stats-number text-warning">@Model.Student.NoShowCount</div>
                    <div class="stats-label">No-Shows</div>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card text-center h-100">
                <div class="card-body stats-card">
                    <i class="bi bi-box-seam text-info" style="font-size: 2rem;"></i>
                    <div class="stats-number text-info">@Model.AvailablePackages.Count()</div>
                    <div class="stats-label">Available Today</div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- My Reservations -->
        <div class="col-lg-8 mb-4">
            <div class="card h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="bi bi-bookmark-heart text-primary me-2"></i>
                        My Reservations
                    </h5>
                    <a href="@Url.Action("MyReservations")" class="btn btn-outline-primary btn-sm">
                        View All
                    </a>
                </div>
                <div class="card-body">
                    @if (!Model.MyReservations.Any())
                    {
                        <div class="text-center py-4">
                            <i class="bi bi-bookmark text-muted" style="font-size: 3rem;"></i>
                            <h6 class="mt-3 text-muted">No reservations yet</h6>
                            <p class="text-muted">Start browsing packages to make your first reservation!</p>
                            <a href="@Url.Action("AvailablePackages")" class="btn btn-primary">
                                <i class="bi bi-search me-1"></i>Browse Packages
                            </a>
                        </div>
                    }
                    else
                    {
                        <div class="row g-3">
                            @foreach (var reservation in Model.MyReservations.Take(2))
                            {
                                <div class="col-12">
                                    <div class="border rounded p-3">
                                        <div class="row align-items-center">
                                            <div class="col-md-8">
                                                <h6 class="mb-1">@reservation.Name</h6>
                                                <div class="small text-muted">
                                                    <i class="bi bi-geo-alt me-1"></i>@reservation.CanteenLocation, @reservation.City
                                                </div>
                                                <div class="small text-muted">
                                                    <i class="bi bi-clock me-1"></i>@reservation.PickupTime.ToString("dd/MM/yyyy HH:mm")
                                                </div>
                                            </div>
                                            <div class="col-md-2 text-center">
                                                <div class="price-badge">€@reservation.Price.ToString("F2")</div>
                                            </div>
                                            <div class="col-md-2 text-end">
                                                <div class="btn-group-vertical" role="group">
                                                    <a href="@Url.Action("PackageDetails", new { id = reservation.Id })" 
                                                       class="btn btn-outline-primary btn-sm">
                                                        <i class="bi bi-eye"></i>
                                                    </a>
                                                    <form method="post" asp-action="CancelReservation" class="d-inline">
                                                        <input type="hidden" name="packageId" value="@reservation.Id" />
                                                        <button type="submit" class="btn btn-outline-danger btn-sm"
                                                                onclick="return confirm('Cancel this reservation?')">
                                                            <i class="bi bi-x"></i>
                                                        </button>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Available Packages -->
        <div class="col-lg-4 mb-4">
            <div class="card h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="bi bi-box-seam text-success me-2"></i>
                        Available Now
                    </h5>
                    <a href="@Url.Action("AvailablePackages")" class="btn btn-outline-success btn-sm">
                        View All
                    </a>
                </div>
                <div class="card-body">
                    @if (!Model.AvailablePackages.Any())
                    {
                        <div class="text-center py-4">
                            <i class="bi bi-box text-muted" style="font-size: 2.5rem;"></i>
                            <h6 class="mt-3 text-muted">No packages available</h6>
                            <p class="small text-muted">Check back later for new packages!</p>
                        </div>
                    }
                    else
                    {
                        <div class="row g-2">
                            @foreach (var package in Model.AvailablePackages)
                            {
                                <div class="col-12">
                                    <div class="border rounded p-2">
                                        <div class="d-flex justify-content-between align-items-start">
                                            <div class="flex-grow-1">
                                                <h6 class="mb-1 small">@package.Name</h6>
                                                <div class="small text-muted">
                                                    <i class="bi bi-geo-alt me-1"></i>@package.CanteenLocation
                                                </div>
                                                <div class="small text-muted">
                                                    <i class="bi bi-clock me-1"></i>@package.PickupTime.ToString("HH:mm")
                                                </div>
                                            </div>
                                            <div class="text-end">
                                                <div class="fw-bold text-success small">€@package.Price.ToString("F2")</div>
                                                <a href="@Url.Action("PackageDetails", new { id = package.Id })" 
                                                   class="btn btn-success btn-sm">
                                                    <i class="bi bi-eye"></i>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>

    @if (Model.Student.IsBlocked())
    {
        <div class="row mt-4">
            <div class="col-12">
                <div class="alert alert-danger">
                    <h5 class="alert-heading">
                        <i class="bi bi-exclamation-triangle me-2"></i>Account Blocked
                    </h5>
                    <p class="mb-0">
                        Your account has been blocked due to @Model.Student.NoShowCount no-shows. 
                        Please contact the canteen staff to resolve this issue and restore your reservation privileges.
                    </p>
                </div>
            </div>
        </div>
    }
</div>